<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<style>
			.mui-content {
				background: white;
			}
			
			.stars {
				width: 15px!important;
				height: 15px;
				display: inline-block;
			}
			
			.mui-row {
				padding: 10px 10px 10px 10px;
			}
			
			.mui-pull-right {
				color: gray;
				font-size: 14px;
			}
			
			#arrange {
				width: 120px;
				height: 30px;
				background: url(images/img11.png) no-repeat;
				background-size: contain;
				color: white;
				border: none;
				margin-right: 10px;
			}
			
			#commentContent {
				border: none;
				background: #f2f2f2;
				height: 100px;
			}
			
			#fiveStars {
				display: inline-block;
			}
			
			#fiveStars_2 {
				display: inline-block;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">评价服务</h1>
		</header>
		<div class="mui-content">
			<div class="mui-row">
				家政公司&#12288;
				<div id="fiveStars">
					<img src="images/ic_comment_normal.png" class="stars" data-index="1" />
					<img src="images/ic_comment_normal.png" class="stars" data-index="2" />
					<img src="images/ic_comment_normal.png" class="stars" data-index="3" />
					<img src="images/ic_comment_normal.png" class="stars" data-index="4" />
					<img src="images/ic_comment_normal.png" class="stars" data-index="5" />
				</div>
				<div class="mui-pull-right">
					满意请给五星哦～
				</div>
			</div>
			<div class="mui-row">
				家政人员&#12288;
				<div id="fiveStars_2">
					<img src="images/ic_comment_normal.png" class="stars" data-index="1" />
					<img src="images/ic_comment_normal.png" class="stars" data-index="2" />
					<img src="images/ic_comment_normal.png" class="stars" data-index="3" />
					<img src="images/ic_comment_normal.png" class="stars" data-index="4" />
					<img src="images/ic_comment_normal.png" class="stars" data-index="5" />
				</div>
			</div>
			<div class="mui-row">
				<textarea placeholder="请对家政公司或家政人员作出评价" id="commentContent"></textarea>
			</div>
			<div class="mui-row">
				<button type="button" class="mui-btn mui-pull-right" id="arrange">提交</button>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/app.js" ></script>
		<script type="text/javascript" src="js/xiachenshi.js"></script>
		<script type="text/javascript">
			var companyCom = 0,
				peopleCom = 0;

			mui.plusReady(function() {
				var loginData = JSON.parse(localStorage.getItem('login'));
				if(!loginData) {
					return;
				}
				var mbi_id = loginData.data.info.mbi_id;
				var self = plus.webview.currentWebview();
				var ob_id = self.ob_id || '';
				var company_id = self.company_id || '';
				var og_id = self.og_id || '';
				document.getElementById('arrange').addEventListener('tap', function(){
					submitComment(mbi_id, ob_id, company_id, og_id);
				})
//				submitComment(mbi_id, ob_id, company_id, og_id);
				
			})
			mui('#fiveStars').on('tap', 'img', function() {
				var index = parseInt(this.getAttribute("data-index")); //获取当前元素的索引值
				companyCom = index;
				var parent = this.parentNode; //获取当前元素的父节点
				var children = parent.children; //获取父节点下所有子元素
				if(this.src.slice(-21) == "ic_comment_normal.png") { //判断当前节点列表中是否含有.mui-icon-star元素
					for(var i = 0; i < index; i++) { //亮星
						children[i].src = "images/ic_comment_press.png"
						//              children[i].classList.remove('mui-icon-star');
						//              children[i].classList.add('mui-icon-star-filled');
					}
				} else { //重置已经亮星的元素
					for(var i = index; i < 5; i++) {
						children[i].src = "images/ic_comment_normal.png"
						//          children[i].classList.add('mui-icon-star')
						//          children[i].classList.remove('mui-icon-star-filled')
					}
				}
				//  document.getElementById("info").innerHTML = parent.previousElementSibling.innerText  + "：" + index "星好评";
			})
			mui('#fiveStars_2').on('tap', 'img', function() {
				var index = parseInt(this.getAttribute("data-index"));
				peopleCom = index;
				var parent = this.parentNode;
				var children = parent.children;
				if(this.src.slice(-21) == "ic_comment_normal.png") {
					for(var i = 0; i < index; i++) {
						children[i].src = "images/ic_comment_press.png"
						//              children[i].classList.remove('mui-icon-star');
						//              children[i].classList.add('mui-icon-star-filled');
					}
				} else {
					for(var i = index; i < 5; i++) {
						children[i].src = "images/ic_comment_normal.png"
						//          children[i].classList.add('mui-icon-star')
						//          children[i].classList.remove('mui-icon-star-filled')
					}
				}
				//  document.getElementById("info").innerHTML = parent.previousElementSibling.innerText  + "：" + index "星好评";
			})

			function submitComment(mbi_id, ob_id, company_id, og_id) {
				var content = document.getElementById('commentContent').value;
				var commentParam = {
					service: 'Hlbr365app.Goods.PushComment',
					mbi_id: mbi_id,
					ob_id: ob_id,
					jg_id: og_id,
					jci_id: company_id,
					jzc_level: peopleCom,
					jci_level: companyCom,
					jzc_type: 1,
					jzc_pid: 0,
					jzc_content: content
				}
				wAjax(commentParam, function(result){
					plus.nativeUI.toast('提交成功！');
					mui.back();
				})
			}
		</script>
	</body>

</html>