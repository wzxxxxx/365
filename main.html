<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />

		<style>
			ul {
				font-size: 14px;
				color: #8f8f94;
			}
			
			.mui-btn {
				padding: 10px;
			}
			
			.mui-pull-right {
				background-image: ;
			}
			
			.mui-title {
				color: white;
			}
			
			.mui-bar-nav {
				padding-right: 15px;
				background: red;
			}
			#city_name{
				color: white;
				font-size: 14px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h1 id="title" class="mui-title"></h1>
			<button id='setting' class=" mui-pull-right mui-btn-link"></button>
			<button id="chooseCity" class="mui-btn  mui-btn-link mui-pull-left">
					<span id="city_name">呼伦贝尔市</span>
					<img src="images/jiantou2.png" />
			</button>
		</header>
		<div class="mui-content">
			<div class="mui-content-padded">
				<nav class="mui-bar mui-bar-tab" style="background-color: #fff;">
					<a id="shouye" class="mui-tab-item mui-active" href="tab_shouye.html">
						<span class="iconstyle mui-icon iconfont" style="background: url(images/首页icon.png) no-repeat;"></span>
						<span class="mui-tab-label">首页</span>
					</a>
					<a id="service" class="mui-tab-item" href="tab_service.html">
						<span class="iconstyle mui-icon iconfont" style="background: url(images/服务icon2.png) no-repeat;"></span>
						<span class="mui-tab-label">服务</span>
					</a>
					<a id="class" class="mui-tab-item " href="tab_class.html">
						<span class="iconstyle mui-icon iconfont" style="background: url(images/课堂\(2\).png) no-repeat;"></span>
						<span class="mui-tab-label">小课堂</span>
					</a>
					<a id="order" class="mui-tab-item" href="tab_order.html">
						<span class="iconstyle mui-icon iconfont" style="background: url(images/订单2.png) no-repeat;"><span id="infoNo" class="mui-badge" style="background-color: #d7000f;display: none;"></span></span>
						<span class="mui-tab-label">订单</span>
					</a>
					<a id="mine" class="mui-tab-item" href="tab_mine.html">
						<span class="iconstyle mui-icon iconfont" style="background: url(images/我的icon2.png) no-repeat;"></span>
						<span class="mui-tab-label">我的</span>
					</a>
				</nav>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/app.js"></script>
		<script>
			(function($, doc) {
				$.init();
				var settings = app.getSettings();
				var account = doc.getElementById('account');
				//				window.addEventListener('show', function() {
				//					var state = app.getState();
				//					account.innerText = state.account;
				//				}, false);

				var subpages = ['tab_shouye.html', 'tab_service.html', 'tab_class.html', 'tab_order.html', 'tab_mine.html'];
				var subpage_style = {
					top: '44px',
					bottom: '50px'
				};
				var aniShow = {};
				var title = doc.getElementById("title");
				//激活当前项
				var activeTab = subpages[0];
				//选项卡点击事件
				$(".mui-bar-tab").on('tap', 'a', function(e) {
					var targetTab = this.getAttribute('href');
					console.log(targetTab);
					if(targetTab == activeTab) {
						return;
					}
					//更换标题
					var labelVal = this.querySelector('.mui-tab-label').innerHTML;
					title.innerHTML = labelVal;
					//若为IOS平台或非首次显示，则直接显示
					if(mui.os.ios || aniShow[targetTab]) {
						plus.webview.show(targetTab);
					} else {
						temp[targetTab] = "true";
						var temp = {};
						$.extend(aniShow, temp);
						plus.webview.show(targetTab, "fade-in", 300);
					}
					//隐藏当前;
					plus.webview.hide(activeTab);
					//更改当前活跃的选项卡
					activeTab = targetTab;
				});

				function preloadMainPage() {
					var temp = {};
					var self = plus.webview.currentWebview();
					var screenHeight = document.body.clientHeight - 44 - 50;
					var pageExtras = {
						"pageHeight": screenHeight
					};
					var sub = plus.webview.create(subpages[0], subpages[0], subpage_style, pageExtras);
					temp[subpages[0]] = "true";
					$.extend(aniShow, temp); //将两个对象合并在一起
				}

				function preloadOtherPages() {
					var screenHeight = doc.body.clientHeight - 44 - 50;
					var pageExtras = [{
							"pageHeight": screenHeight,
						},
						{
							"pageHeight": screenHeight
						},
						{
							"pageHeight": screenHeight
						},
						{
							"pageHeight": screenHeight,
						}
					];
					setTimeout(function() {
						var self = plus.webview.currentWebview();
						for(var i = 1; i < 5; i++) {
							var productView = $.preload({
								url: subpages[i],
								id: subpages[i],
								styles: subpage_style,
								extras: pageExtras[i]
							});
						}
					}, 500);
				}

				$.plusReady(function() {
					//					var settingPage = $.preload({
					//						"id": 'setting',
					//						"url": 'setting.html'
					//					});
					//					//设置
					//					var settingButton = doc.getElementById('setting');
					//					//settingButton.style.display = settings.autoLogin ? 'block' : 'none';
					//					settingButton.addEventListener('tap', function(event) {
					//						$.openWindow({
					//							id: 'setting',
					//							show: {
					//								aniShow: 'pop-in'
					//							},
					//							styles: {
					//								popGesture: 'hide'
					//							},
					//							waiting: {
					//								autoShow: false
					//							}
					//						});
					//					});
					//					$.oldBack = mui.back;
					//					var backButtonPress = 0;
					//					$.back = function(event) {
					//						backButtonPress++;
					//						if(backButtonPress > 1) {
					//							plus.runtime.quit();
					//						} else {
					//							plus.nativeUI.toast('再按一次退出应用');
					//						}
					//						setTimeout(function() {
					//							backButtonPress = 0;
					//						}, 1000);
					//						return false;
					//					};
					//					

					preloadMainPage();
					preloadOtherPages();
					
						var showCityPickerButton = document.getElementById('chooseCity');
				showCityPickerButton.addEventListener('tap', function(event) {
					if(window.plus) {
						//		ws = plus.webview.currentWebview();
						//		// 显示遮罩层
						//		ws.setStyle({
						//			mask: "rgba(0,0,0,0.5)"
						//		});
//						var topoffset = tiaozhengTOP();
						mui.openWindow({
							url: 'city_select.html',
							id: 'city_select.html',
							waiting: {
								autoShow: false //自动显示等待框，默认为true
							},
							styles: {
								//				top: '325px',
//								top: topoffset,
								bottom: '0px',
								background: 'transparent',
								opacity: 1,
								//				mask:'rgba(0,0,0,0.5)',
								zindex: "100"
							}
						});
						// 点击关闭遮罩层
						//		ws.addEventListener("maskClick", function() {
						//			ws.setStyle({
						//				mask: "none"
						//			});
						//			if(plus.webview.getWebviewById("city_select.html")!=null)
						//			plus.webview.getWebviewById("city_select.html").close();
						//		}, false);
					} else {
						mui.toast("请在html5+引擎环境使用");
					}
				}, false);

				});
			}(mui, document));
		</script>
	</body>

</html>