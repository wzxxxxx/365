<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />

		<style>
			ul {
				font-size: 14px;
				color: #8f8f94;
			}
			
			.mui-btn {
				padding: 10px;
			}
			
			.mui-pull-right {
				background-image: ;
			}
			
			.mui-bar-nav {
				padding-right: 15px;
			}
			
			#openPopover {
				color: white;
				font-size: 14px;
				max-width: 50px;
				overflow: hidden;
				white-space: nowrap;
				text-overflow: ellipsis;
				display: inline-block;
			}
			
			#searchBtn {
				width: 200px;
				height: 30px;
				margin: 7px;
				border-radius: 20px;
				color: gainsboro;
			}
			
			#noticeImg {
				height: 25px;
				width: 25px;
				margin-top: 10px;
			}
			
			.mui-active{
				color: red!important;
			}
			.tab-icon{
				width: 20px;
				height: 20px;
				opacity: 0.4;
			}
			.mui-active .tab-icon{
				opacity: 1.0!important;
			}
			
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<button id="chooseCity" class="mui-btn  mui-btn-link mui-pull-left">
					<a id="openPopover">海拉尔区</a>
					<img src="images/地区选择.png" />
			</button>
			<h1 id="title" class="mui-title"></h1>
			<button id="searchBtn"><img src="images/搜索.png" style="margin-bottom: -4px; margin-right: 5px;"／>服务分类 服务内容</button>
			<button class="mui-btn mui-btn-blue mui-btn-link mui-pull-right">
				<img id='noticeImg' src="images/message1.png" />
			</button>

		</header>
		<!--<div id="popover" class="mui-popover">
			<ul class="mui-table-view" id="mui-template">
				<script type="text/template" id="temp">
					<% for(var i in record){ var item=record[i]; %>
					<li class="mui-table-view-cell">
						<a href="#" id="<%=item.id%>">
							<%=item.name%>
						</a>
					</li>
					<%}%>
				</script>
			</ul>
		</div>-->
		<div class="mui-content">
			<div class="mui-content-padded">
				<nav class="mui-bar mui-bar-tab" style="background-color: #fff;">
					<a id="shouye" class="mui-tab-item mui-active" href="tab_shouye.html">
						<span class="iconstyle mui-icon iconfont">
							<img src="images/首页icon.png"  class="tab-icon"/>
						</span>
						<span class="mui-tab-label">首页</span>
					</a>
					<a id="service" class="mui-tab-item" href="tab_service.html">
						<span class="iconstyle mui-icon iconfont">
							<img src="images/服务icon2.png"  class="tab-icon"/>
						</span>
						<span class="mui-tab-label">服务</span>
					</a>
					<a id="class" class="mui-tab-item " href="tab_class.html">
						<span class="iconstyle mui-icon iconfont">
							<img src="images/课堂(2).png"  class="tab-icon"/>
						</span>
						<span class="mui-tab-label">小课堂</span>
					</a>
					<a id="order" class="mui-tab-item" href="tab_order.html">
						<span class="iconstyle mui-icon iconfont">
							<img src="images/订单2.png"  class="tab-icon"/>
						</span>
						<span class="mui-tab-label">订单</span>
					</a>
					<a id="mine" class="mui-tab-item" href="tab_mine.html">
						<span class="iconstyle mui-icon iconfont">
							<img src="images/我的icon2.png"  class="tab-icon"/>
						</span>
						<span class="mui-tab-label">我的</span>
					</a>
				</nav>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/arttmpl.js"></script>
		<script src="js/app.js"></script>
		<script>
			(function($, doc) {
				$.init();
				var settings = app.getSettings();
				var account = doc.getElementById('account');
				//				window.addEventListener('show', function() {
				//					var state = app.getState();
				//					account.innerText = state.account;
				//				}, false);

				var subpages = ['tab_shouye.html', 'tab_service.html', 'tab_class.html', 'tab_order.html', 'tab_mine.html'];
				var subpage_style = {
					top: '44px',
					bottom: '50px'
				};
				var aniShow = {};
				var title = doc.getElementById("title");
				//激活当前项
				var activeTab = subpages[0];

				//				window.addEventListener('changeCity', function(event) {
				//					if(event) {
				//						var provinceCode = event.detail.provinceCode; //省id
				//						var provinceName = event.detail.provinceName; //省名称
				//						var cityCode = event.detail.cityCode; //市id
				//						var cityName = event.detail.cityName; //市名称
				//						var areaCode = event.detail.areaCode; //区id
				//						var areaName = event.detail.areaName; //区名称
				//
				//						document.getElementById("city_name").innerText = cityName;
				//					}
				//				});
				
				document.getElementById('chooseCity').addEventListener('tap', function(){
					var shouye = plus.webview.getWebviewById('tab_shouye.html');
					mui.fire(shouye, 'openPop', null);
				})
				
				document.getElementById('noticeImg').addEventListener('tap', function(){
					mui.openWindow({
					url: 'notice.html',
					id: 'notice.html'
					})
				})

				//选项卡点击事件
				$(".mui-bar-tab").on('tap', 'a', function(e) {

					var targetTab = this.getAttribute('href');
					if(targetTab == 'tab_shouye.html') {
						document.getElementById("chooseCity").setAttribute("class", "mui-btn  mui-btn-link mui-pull-left");
						document.getElementById('searchBtn').setAttribute('class', '');
						document.getElementById('noticeImg').setAttribute('class', '');
					} else {
						document.getElementById("chooseCity").setAttribute("class", "mui-hidden");
						document.getElementById('searchBtn').setAttribute('class', 'mui-hidden');
						document.getElementById('noticeImg').setAttribute('class', 'mui-hidden');
					}

					if(targetTab == activeTab) {
						return;
					}
					//更换标题
					var labelVal = this.querySelector('.mui-tab-label').innerHTML;
					title.innerHTML = labelVal;
					//若为IOS平台或非首次显示，则直接显示
					if(mui.os.ios || aniShow[targetTab]) {
						plus.webview.show(targetTab);
					} else {
						temp[targetTab] = "true";
						var temp = {};
						$.extend(aniShow, temp);
						plus.webview.show(targetTab, "fade-in", 300);
					}
					//隐藏当前;
					plus.webview.hide(activeTab);
					//更改当前活跃的选项卡
					activeTab = targetTab;
				});
				
		   window.addEventListener('toSerive', function(event) {
				if(event) {
					mui.trigger(document.getElementById('service'), 'tap');
				}

			});
			
			window.addEventListener('changeCity', function(event) {
				if(event) {
					var cityName = event.detail.cityName; //市id
					document.getElementById('openPopover').innerHTML = cityName;
				}
			});
			
			window.addEventListener('toClass', function(event) {
//					document.getElementById('class').setAttribute('');
					mui.trigger(document.getElementById('class'), 'tap');

			});

				function preloadMainPage() {
					var temp = {};
					var self = plus.webview.currentWebview();
					var screenHeight = document.body.clientHeight - 44 - 50;
					var pageExtras = {
						"pageHeight": screenHeight
					};
					var sub = plus.webview.create(subpages[0], subpages[0], subpage_style, pageExtras);
					temp[subpages[0]] = "true";
					$.extend(aniShow, temp); //将两个对象合并在一起
				}

				function preloadOtherPages() {
					var screenHeight = doc.body.clientHeight - 44 - 50;
					var pageExtras = [{
							"pageHeight": screenHeight,
						},
						{
							"pageHeight": screenHeight
						},
						{
							"pageHeight": screenHeight
						},
						{
							"pageHeight": screenHeight,
						}
					];
					setTimeout(function() {
						var self = plus.webview.currentWebview();
						for(var i = 1; i < 5; i++) {
							var productView = $.preload({
								url: subpages[i],
								id: subpages[i],
								styles: subpage_style,
								extras: pageExtras[i]
							});
						}
					}, 500);
				}

				function getConutryList() {
					var getCountryParam = {
						service: 'App.PublicClass.Country',
						id: 150700
					}
					wAjax(getCountryParam, function(result) {
						var countryList = result.data.list;
						var str = template('temp', {
							'record': countryList
						});
						document.getElementById("mui-template").innerHTML = str;
					})
				}

//				mui("#mui-template").on('tap', 'a', function(e) {
//					var id = this.getAttribute("id");
//					document.getElementById('openPopover').innerHTML = this.innerHTML;
//					var shouye = plus.webview.getWebviewById('tab_shouye.html');
//					var service = plus.webview.getWebviewById('tab_service.html');
//					var param = {
//						cityCode: id
//					}
//					mui.fire(shouye, 'changeCity', param);
//					mui.fire(service, 'changeCity', param);
//					mui('#popover').popover('hide');
//
//				});

				$.plusReady(function() {
					//					var settingPage = $.preload({
					//						"id": 'setting',
					//						"url": 'setting.html'
					//					});
					//					//设置
					//					var settingButton = doc.getElementById('setting');
					//					//settingButton.style.display = settings.autoLogin ? 'block' : 'none';
					//					settingButton.addEventListener('tap', function(event) {
					//						$.openWindow({
					//							id: 'setting',
					//							show: {
					//								aniShow: 'pop-in'
					//							},
					//							styles: {
					//								popGesture: 'hide'
					//							},
					//							waiting: {
					//								autoShow: false
					//							}
					//						});
					//					});
					//					$.oldBack = mui.back;
					//					var backButtonPress = 0;
					//					$.back = function(event) {
					//						backButtonPress++;
					//						if(backButtonPress > 1) {
					//							plus.runtime.quit();
					//						} else {
					//							plus.nativeUI.toast('再按一次退出应用');
					//						}
					//						setTimeout(function() {
					//							backButtonPress = 0;
					//						}, 1000);
					//						return false;
					//					};
					//					
//					getConutryList();
					preloadMainPage();
					preloadOtherPages();


					var searchButton = document.getElementById('searchBtn');
					searchButton.addEventListener('tap', function(event) {
						if(window.plus) {
							mui.openWindow({
								url: 'search.html',
								id: 'search.html',
								waiting: {
									autoShow: false //自动显示等待框，默认为true
								}
							});
						} else {
							mui.toast("请在html5+引擎环境使用");
						}
					}, false)

				});
			}(mui, document));
		</script>
	</body>