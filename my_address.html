<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<style>
			#addAddress {
				width: 150px;
				height: 40px;
				margin-left: auto; 
    				margin-right:auto; 
    				display:block;
				background: url(images/img11.png) no-repeat;
				background-size: contain;
				color: white;
				border: none;
				position: fixed;
				bottom: 0px;
				left: 50%;
				transform: translate(-50%, -10%);
				/*left: 100px;*/
			}
			
			.mui-row {
				background: white;
				margin-bottom: 10px;
				padding: 10px;
				display: inline-block;
				width: 100%;
			}
			
			.mui-row img {
				height: 20px;
				width: 15px;
				margin-top: 40px;
			}
			
			span {
				color: red;
			}
			input {
				margin-right: 10px;
			}
			.mui-col-xs-11{
				font-size: 14px;
			}
			/*#mui-template{
				width: 100%;
			}*/
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">我的地址</h1>
		</header>
		<div class="mui-content">
			<div id="mui-template">
				<script type="text/template" id="temp">
					<% for(var i in record){ var item=record[i]; %>
					<div class="mui-row" id="<%=item.mda_id%>">
						<div class="mui-col-sm-1 mui-col-xs-1">
							<img src="images/img19.png" />
						</div>
						<div class="mui-col-sm-11 mui-col-xs-11">
							<div>联系人:
								<%=item.mda_contacts_name%>
								<div class="mui-pull-right">
									<%=item.mda_contacts_phone%>
								</div>
							</div>
							<div>联系地址:
								<%=item.mda_contacts_province_name%>
								<%=item.mda_contacts_city_name%>
								<%=item.mda_contacts_county_name%>
								<%=item.mda_contacts_address%> </div>
							<h5>----------------------------------------------------------</h5>
							<div>
								<input type="checkbox" disabled="<%=item.mda_default%>" />默认地址
								<span id="<%=item.mda_id%>" class="mui-pull-right delete">删除</span>
								<span name="<%=item.mda_id%>" class="mui-pull-right edit">编辑&nbsp;&nbsp;&nbsp;</span>
							</div>
						</div>
					</div>
					<%}%>
				</script>

			</div>
			<button type="button" class="mui-btn mui-pull-right" id="addAddress">添加地址</button>
		</div>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/xiachenshi.js"></script>
		<script type="text/javascript" src="js/app.js"></script>
		<script type="text/javascript" src="js/arttmpl.js"></script>
		<script type="text/javascript">
			var mbi_id = 58;
			mui.plusReady(function() {
				var loginData = JSON.parse(localStorage.getItem('login'));
				if(!loginData) {
					return;
				}
				mbi_id = loginData.data.info.mbi_id;
				getAddressList(mbi_id);

				var self = plus.webview.currentWebview();
				if(self.isChoosing) {
					mui("#mui-template").on('tap', '.mui-row', function(e) {
						var id = this.getAttribute("id");
						var order = plus.webview.getWebviewById('order_confirm.html');
						var param = {
							addr_id: id
						};
						mui.fire(order, "addr", param);
						//					order.reload();		
						setTimeout(function() {
							mui.back();
						}, 500)

					});
				}

				var addAddress = document.getElementById('addAddress');
				addAddress.addEventListener('tap', function() {
					mui.openWindow({
						url: "add_address.html",
						id: "add_address.html"
					})
				})
			})

			function getAddressList() {
				var getAddrParam = {
					service: 'Hlbr365app.MemberDeliveryAddress.GetList',
					mbi_id: mbi_id
				}
				wAjax(getAddrParam, function(result) {
					var addrList = result.data.info;
					var str = template('temp', {
						'record': addrList
					});
					document.getElementById("mui-template").innerHTML = str;
				})
			}

			function deleteAddress(mda_id) {
				var deleteParam = {
					service: 'Hlbr365app.MemberDeliveryAddress.Delete',
					mda_id: mda_id,
					mbi_id: mbi_id
				}
				wAjax(deleteParam, function() {
					location.reload();
				})
			}

			mui("#mui-template").on('tap', '.delete', function(e) {
				var id = this.getAttribute("id");
				mui.confirm('确认删除?', '家政365', ['是', '否'], function(event){
					if(event.index == 0){
						deleteAddress(id);
					}
				});
			});

			mui("#mui-template").on('tap', '.edit', function(e) {
				var name = this.getAttribute("name");
				mui.openWindow({
					url: "edit_address.html",
					id: "edit_address.html",
					extras: {
						addr_id: name
					}
				})

			});
		</script>
	</body>

</html>
